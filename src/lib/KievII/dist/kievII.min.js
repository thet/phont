/*! kievII v0.5.0 built on 04-05-2013 */
(function(){var t={};t.extend=function(t,e){var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t,t.superclass=e.prototype,e.prototype.constructor==Object.prototype.constructor&&(e.prototype.constructor=e)},t.clone=function(t){var e;if(null===t||"object"!=typeof t)return t;if(t instanceof Date)return e=new Date,e.setTime(t.getTime()),e;if(t instanceof Array){e=[];for(var i=0,s=t.length;s>i;++i)e[i]=clone(t[i]);return e}if(t instanceof Object){e={};for(var r in t)t.hasOwnProperty(r)&&(e[r]=clone(t[r]));return e}throw Error("Unable to copy obj! Its type isn't supported.")},t.mergeObject=function(t,e){var i={};if(!e)return t;for(var s in t)i[s]=s in e?e[s]:t[s];return i},t.UIElement=function(t){arguments.length&&this.getready(t)},t.UIElement.prototype.getready=function(t){if(this.ID=t.ID,this.isListening=t.isListening,this.isListening===void 0&&(this.isListening=!0),"boolean"!=typeof this.isListening)throw"Property isListening for element "+this.ID+" is not boolean "+this.isListening;if(this.isVisible=t.isVisible,this.isVisible===void 0&&(this.isVisible=!0),"boolean"!=typeof this.isVisible)throw"Property isVisible for element "+this.ID+" is not boolean "+this.isVisible;this.xOrigin=t.left,this.yOrigin=t.top,this.ROILeft=t.ROILeft!==void 0?t.ROILeft:this.xOrigin,this.ROITop=t.ROITop!==void 0?t.ROITop:this.yOrigin,this.ROIWidth=t.ROIWidth,this.ROIHeight=t.ROIHeight,this.values={},this.transparency=t.transparency||1,this.objParms=t.objParms,t!==void 0&&(this.onValueSet=t.onValueSet)},t.UIElement.prototype.isInROI=function(){return!1},t.UIElement.prototype.getValues=function(){var t,e=[];for(t in this.values)this.values.hasOwnProperty(t)&&e.push(t);return e},t.UIElement.prototype.getXCoord=function(){return this.xOrigin},t.UIElement.prototype.getYCoord=function(){return this.yOrigin},t.UIElement.prototype.getWidth=function(){return this.width},t.UIElement.prototype.getHeight=function(){return this.height},t.UIElement.prototype.setHeight=function(t){this.height=t,this.ROIHeight===void 0&&(this.ROIHeight=t)},t.UIElement.prototype.setWidth=function(t){this.width=t,this.ROIWidth===void 0&&(this.ROIWidth=t)},t.UIElement.prototype.getValue=function(t){if(this.values[t]===void 0)throw Error("Slot "+t+" not present or value undefined");return this.values[t]},t.UIElement.prototype.setValue=function(t,e){if(this.values[t]===void 0)throw Error("Slot "+t+" not present or value undefined");e!==this.values[t]&&(this.values[t]=e)},t.UIElement.prototype.setListening=function(t){if("boolean"!=typeof t)throw"Property isListening for element "+this.ID+" is not boolean "+t;this.isListening=t},t.UIElement.prototype.getListening=function(){return this.isListening},t.UIElement.prototype.refresh=function(t){var e="call_"+t.type;if("function"!=typeof this[e])throw"Element "+this.ID+" "+e+" is not a function. Its type is "+typeof this[e];this[e](t)},t.UIElement.prototype.call_CANVAS2D=function(t){var e="refresh_"+t.type;if(t.context.save(),t.context.globalAlpha=this.transparency,"function"!=typeof this[e])throw"Element "+this.ID+" "+e+" is not a function. Its type is "+typeof this[e];this[e](t),t.context.restore()},t.UIElement.prototype.getID=function(){return this.ID},t.UIElement.prototype.setDrawClass=function(t){this.drawClass=t},t.UIElement.prototype.setVisible=function(t){if("boolean"!=typeof t)throw"Property isVisible for element "+this.ID+" is not boolean "+t;this.isVisible=t},t.UIElement.prototype.getVisible=function(){return this.isVisible},t.UIElement.prototype.setGraphicWrapper=function(t){this.wrapper=t},t.UI=function(e,i){this.getEventPosition=function(t,e){var i,s,r=parseInt(document.defaultView.getComputedStyle(e,null).paddingLeft,10)||0,n=parseInt(document.defaultView.getComputedStyle(e,null).paddingTop,10)||0,o=parseInt(document.defaultView.getComputedStyle(e,null).borderLeftWidth,10)||0,h=parseInt(document.defaultView.getComputedStyle(e,null).borderTopWidth,10)||0,a=document.body.parentNode,l=a.offsetTop,u=a.offsetLeft,d=e,c=0,g=0;if(d.offsetParent!==void 0)do c+=d.offsetLeft,g+=d.offsetTop;while(d=d.offsetParent);c+=r+o+u,g+=n+h+l,i=t.pageX-c,s=t.pageY-g;var f=parseInt(document.defaultView.getComputedStyle(e,null).getPropertyValue("width"),10)||0,p=parseInt(document.defaultView.getComputedStyle(e,null).getPropertyValue("height"),10)||0,v=e.getAttribute("width"),y=e.getAttribute("height"),m=v/f,b=y/p;return i*=m,s*=b,{x:i,y:s}},this.onMouseEvent=function(){var t=this;return function(e){var i=e.type,s=t.getEventPosition(e,t.domElement);t.elementsNotifyEvent(s.x,s.y,i)}},this.onHammerEvent=function(){var t=this;return function(e){var i=e.gesture.srcEvent,s=e.type,r=t.getEventPosition(i,t.domElement,e);t.elementsNotifyEvent(r.x,r.y,s)}},this.elementsNotifyEvent=function(t,e,i){for(var s=this.zMax;s>=this.zMin;s-=1)if(this.zArray[s]!==void 0)for(var r=this.zArray[s].length-1;r>=0;r-=1)if(this.zArray[s][r].getListening()&&"function"==typeof this.zArray[s][r][i]){var n=this.zArray[s][r][i](t,e);if(n!==void 0){if(n instanceof Array)for(var o=0;n.length>o;o+=1)this.setValue({elementID:this.zArray[s][r].ID,slot:n[o].slot,value:n[o].value});else this.setValue({elementID:this.zArray[s][r].ID,slot:n.slot,value:n.value});if(this.breakOnFirstEvent===!0)return}}};var s=e.eventTarget||e.target,r=e.renderTarget||e.target;if(this.domElement=s,t.Hammer===void 0)throw"Hammer.js needed!";this.hammer=new t.Hammer(this.domElement,{drag_min_distance:2});var n=this.onHammerEvent();this.hammer.on("dragstart drag dragend swipe tap doubletap hold transformstart transform transformend touch release",n),this.domElement.addEventListener("mouseover",this.onMouseEvent(),!0),this.domElement.addEventListener("mouseout",this.onMouseEvent(),!0),this.elements={},this.connections={},this.zArray=[],this.engine=t.ENGINE.engineFactory(e.type,{target:r}),i!==void 0&&(this.breakOnFirstEvent=i.breakOnFirstEvent||!1),this.addElement=function(t,e){if(this.elements[t.ID]!==void 0)throw Error("Conflicting / Duplicated ID in UI: "+t.ID+" (IDs are identifiers and should be unique)");var i=0;if(e!==void 0&&e.zIndex!==void 0&&(i=e.zIndex),0>i||"number"!=typeof i)throw Error("zIndex "+i+" invalid");this.elements[t.ID]={element:t,zIndex:i},this.zArray[i]===void 0&&(this.zArray[i]=[]),this.zArray[i].push(this.elements[t.ID].element),(this.zMin===void 0||this.zMin>i)&&(this.zMin=i),(this.zMax===void 0||i>this.zMax)&&(this.zMax=i)},this.removeElement=function(t){if(this.elements[t]!==void 0){for(var e=this.elements[t].zIndex,i=this.zArray[e],s=0;i.length>s;s+=1)if(i[s].ID===t){i.splice(s,1);break}delete this.elements[t]}},this.isElement=function(t){return this.elements[t]!==void 0},this.setZIndex=function(t,e){if(void 0===this.elements[t])throw"Could not find element ID: "+t;var i=this.elements[t].zIndex;if(i!==e){this.zArray[e]===void 0&&(this.zArray[e]=[]),(this.zMin===void 0||this.zMin>e)&&(this.zMin=e),(this.zMax===void 0||e>this.zMax)&&(this.zMax=e);for(var s=this.zArray[i],r=this.zArray[e],n=0;s.length>n;n+=1)if(s[n].ID===t){s.splice(n,1);break}r.push(this.elements[t].element),this.elements[t].zIndex=e}},this.getZIndex=function(t){if(this.elements[t]!==void 0)return this.elements[t].zIndex;throw"Could not find element ID: "+t},this.setProp=function(t,e,i){if(void 0===this.elements[t])throw"Could not find ID: "+t+" property: "+e;this.elements[t].element[e]=i},this.getProp=function(t,e){if(this.elements[t]!==void 0)return this.elements[t].element[e];throw"Could not find ID: "+t+" property: "+e},this.getElement=function(t){return this.elements[t].element},this.connectSlots=function(t,e,i,s,r){if(void 0===this.elements[t]||void 0===this.elements[i])throw Error("Element "+t+" or "+i+" not present.");if(this.elements[t].element.values[e]===void 0||this.elements[i].element.values[s]===void 0)throw Error("Slot "+e+" or "+s+" not present.");var n={recvElement:i,recvSlot:s};r!==void 0&&("function"==typeof r.callback&&(n.callback=r.callback),n.cascade=!0,r.cascade!==void 0&&(n.cascade=r.cascade)),this.connections[t]===void 0&&(this.connections[t]={}),this.connections[t][e]===void 0&&(this.connections[t][e]=[]),this.connections[t][e].push(n)},this.resetSlots=function(){this.connections={}},this.unconnectSlots=function(){},this.resetSenderSlot=function(){},this.setValue=function(t){var e,i,s,r,n,o,h,a,l,u,d=[],c=1e3;if(t.elementID===void 0)throw"ID is undefined";if(n=t.elementID,t.value===void 0)throw"value is undefined";if(o=t.value,a=t.fireCallback===void 0?!0:t.fireCallback,l=t.history,void 0===this.elements[n])throw Error("Element "+n+" not present.");if(t.slot===void 0){if(h=this.elements[n].element.defaultSlot,h===void 0)throw"Default slot is undefined!"}else h=t.slot;if(l!==void 0){d=l;for(var g=0;d.length>g;g+=1){if(d.length>c)throw Error("Recursion exceeded");if(d[g].element===n&&d[g].slot===h)return}}if(this.elements[n].element.setValue(h,o),"function"==typeof this.elements[n].element.onValueSet&&a!==!1&&this.elements[n].element.onValueSet(h,this.elements[n].element.values[h],n),d.push({element:n,slot:h}),this.connections[n]!==void 0&&this.connections[n][h]!==void 0)for(r in this.connections[n][h])if(this.connections[n][h].hasOwnProperty(r)){if(e=this.connections[n][h][r],i=e.recvElement,s=e.recvSlot,"function"==typeof e.callback){var f={sender:n,sendSlot:h,recv:i,recvSlot:s,ui:this};u=e.callback(o,f)}var p;p=e.cascade!==!1,this.setValue({elementID:i,slot:s,value:u,history:d,fireCallback:p})}},this.hideElement=function(t){var e;if(void 0===this.elements[t])throw Error("Element "+t+" not present.");e=this.elements[t].element.getVisible(),e===!0&&(this.elements[t].element.setVisible(!1),this.elements[t].element.setListening(!1))},this.unhideElement=function(t){var e;if(void 0===this.elements[t])throw Error("Element "+t+" not present.");e=this.elements[t].element.getVisible(),e===!1&&(this.elements[t].element.setVisible(!0),this.elements[t].element.setListening(!0))},this.setHidden=function(t,e){this.setVisible(t,!e)},this.setVisible=function(t,e){var i;if(void 0===this.elements[t])throw Error("Element "+t+" not present.");i=this.elements[t].element.getVisible(),i!==e&&(this.elements[t].element.setVisible(e),this.elements[t].element.setListening(e))},this.setListening=function(t,e){var i;if(void 0===this.elements[t])throw Error("Element "+t+" not present.");i=this.elements[t].element.getListening(),i!==e&&this.elements[t].element.setListening(e)},this.refreshZ=function(t){for(var e=t,i=this.zArray.length;i>e;e+=1)if("object"==typeof this.zArray[e])for(var s=0,r=this.zArray[e].length;r>s;s+=1)this.zArray[e][s].getVisible()===!0&&this.zArray[e][s].refresh(this.engine)},this.refresh=function(t){t!==!1&&this.reset(),this.zMin!==void 0&&this.refreshZ(this.zMin)},this.reset=function(){this.engine.reset()}},t.Area=function(t){arguments.length&&this.getready(t)},t.extend(t.Area,t.UIElement),t.Area.prototype.getready=function(e){t.Area.superclass.getready.call(this,e),this.values={width:0,height:0,selected:[],xOffset:0,yOffset:0,doubletap:[],held:[]},this.defaultSlot="height",this.color=e.color||"black",this.borderColor=e.borderColor||"green",this.proximity=Math.floor(e.proximity)||10,this.thickness=Math.floor(e.thickness)||this.proximity,0===e.thickness&&(this.thickness=0),this.borders=e.borders||{top:!0,bottom:!0,right:!0,left:!0},this.dragBorders=e.dragBorders||{top:!0,bottom:!0,right:!0,left:!0},this.move=e.move||"all",this.xMonotone=e.xMonotone||!1,this.yMonotone=e.yMonotone||!1;var i=e.height||0,s=e.width||0;this.values.width=s,this.values.height=i;var r=e.left||0,n=e.top||0;this.values.xOffset=r,this.values.yOffset=n},t.Area.prototype.isInArea=function(t,e){var i=!1,s=!1;return this.values.width>0?t>this.values.xOffset&&this.values.xOffset+this.values.width>t&&(i=!0):this.values.xOffset>t&&t>this.values.xOffset+this.values.width&&(i=!0),this.values.height>0?e>this.values.yOffset&&this.values.height+this.values.yOffset>e&&(s=!0):this.values.yOffset>e&&e>this.values.height+this.values.yOffset&&(s=!0),i&&s},t.Area.prototype.tap=t.Area.prototype.dragstart=function(t,e){var i=this.values.xOffset-this.proximity,s=this.values.xOffset+this.proximity,r=this.values.xOffset+this.values.width-this.proximity,n=this.values.xOffset+this.values.width+this.proximity,o=this.values.height+this.values.yOffset+this.proximity,h=this.values.height+this.values.yOffset-this.proximity,a=this.values.yOffset+this.proximity,l=this.values.yOffset-this.proximity;t>i&&s>t&&this.dragBorders.left===!0&&(this.leftSide=!0),t>r&&n>t&&this.dragBorders.right===!0&&(this.rightSide=!0),e>h&&o>e&&this.dragBorders.bottom===!0&&(this.bottomSide=!0),e>l&&a>e&&this.dragBorders.top===!0&&(this.topSide=!0),this.isInArea(t,e)?(this.inside=!0,this.startPoint=[t,e]):this.inside=!1},t.Area.prototype.drag=function(t,e){var i,s,r=[];if(this.leftSide&&this.borders.left){i=this.values.width-(t-this.values.xOffset);var n=t;this.xMonotone&&0>i&&(i=0,n=this.values.xOffset),r.push({slot:"width",value:i}),r.push({slot:"xOffset",value:n})}if(this.rightSide&&this.borders.right&&!this.leftSide&&(i=t-this.values.xOffset,this.xMonotone&&0>i&&(i=0),r.push({slot:"width",value:i})),this.bottomSide&&this.borders.bottom&&(s=this.values.height+(e-(this.values.yOffset+this.values.height)),this.yMonotone&&0>s&&(s=0),r.push({slot:"height",value:s})),this.topSide&&this.borders.top&&!this.bottomSide){s=this.values.height+(this.values.yOffset-e);var o=e;this.yMonotone&&0>s&&(s=0,o=this.values.yOffset),r.push({slot:"yOffset",value:o}),r.push({slot:"height",value:s})}if(r.length>0)return r;if(this.inside&&"none"!==this.move){var h=t-this.startPoint[0],a=e-this.startPoint[1];if(this.startPoint=[t,e],"all"===this.move)return[{slot:"xOffset",value:this.values.xOffset+h},{slot:"yOffset",value:this.values.yOffset+a}];if("x"===this.move)return{slot:"xOffset",value:this.values.xOffset+h};if("y"===this.move)return{slot:"yOffset",value:this.values.yOffset+a}}return void 0},t.Area.prototype.dragend=function(t,e){var i;return this.leftSide=this.rightSide=this.bottomSide=this.topSide=!1,this.inside&&this.isInArea(t,e)&&(i={slot:"selected",value:[t,e]}),this.inside=!1,i},t.Area.prototype.hold=function(t,e){return this.isInArea(t,e)?{slot:"held",value:[t,e]}:void 0},t.Area.prototype.doubletap=function(t,e){return this.isInArea(t,e)?{slot:"doubletap",value:[t,e]}:void 0},t.Area.prototype.setValue=function(e,i){t.Area.superclass.setValue.call(this,e,i)},t.Area.prototype.refresh_CANVAS2D=function(t){if(this.isVisible===!0){t.context.fillStyle=this.color,t.context.strokeStyle=this.borderColor,t.context.lineWidth=this.thickness;var e=Math.floor(this.thickness/2);t.context.fillRect(this.xOrigin+this.values.xOffset+e,this.values.yOffset+e,this.values.width-2*e,this.values.height-2*e),this.thickness>0&&t.context.strokeRect(this.xOrigin+this.values.xOffset,this.values.yOffset,this.values.width,this.values.height)}},t.Area.prototype.getXCoord=function(){return this.values.xOrigin},t.Area.prototype.getYCoord=function(){return this.values.yOrigin},t.Area.prototype.getWidth=function(){return this.values.width},t.Area.prototype.getHeight=function(){return this.values.height},t.Area.prototype.setHeight=function(t){this.values.height=t,this.ROIHeight===void 0&&(this.ROIHeight=t)},t.Area.prototype.setWidth=function(t){this.values.width=t,this.ROIWidth===void 0&&(this.ROIWidth=t)},t.Curve=function(t){arguments.length&&this.getready(t)},t.extend(t.Curve,t.UIElement),t.Curve.prototype.getready=function(e){switch(t.Curve.superclass.getready.call(this,e),this.values={points:[],selected:[],held:[],doubletap_c:[],doubletap_h:[]},this.defaultSlot="points",this.setWidth(e.width),this.setHeight(e.height),this.curveType=e.curveType||"bezier",this.thickness=e.thickness||2,this.curveColor=e.curveColor||"black",this.helperColor=e.helperColor||"#CCCCCC",this.handleColor=e.handleColor||"red",this.curveLabels="boolean"==typeof e.curveLabels?e.curveLabels:!1,this.terminalPointStyle=e.terminalPointStyle||"rect",this.paintTerminalPoints=e.paintTerminalPoints||"all",this.midPointStyle=e.midPointStyle||"circle",this.terminalPointSize=e.terminalPointSize||16,this.midPointSize=e.midPointSize||8,this.terminalPointColor=e.terminalPointColor||this.handleColor,this.midPointColor=e.midPointColor||this.handleColor,this.terminalPointFill=e.terminalPointFill||null,this.midPointFill=e.midPointFill||null,this.xMonotone=e.xMonotone||!1,this.handleSize=e.handleSize||this.terminalPointSize>this.midPointSize?this.terminalPointSize:this.midPointSize,this.handleClicked=null,this.supportPoints=[],this.selectStart=!1,this.whereHappened=[],e.curveType){case"bezier":if(0!==e.points.length%2||4>e.points.length)throw"Incorrect number of points "+e.points.length;break;case"halfcosine":case"smooth":case"linear":if(4!==e.points.length)throw"Incorrect number of points "+e.points.length;break;default:throw"Unknown curve type "+e.curveType}for(var i=[],s=0;e.points.length>s;s+=2)i.push([e.points[s],e.points[s+1]]);this.values.points=i},t.Curve.prototype.isInCurve=function(t,e){for(var i=0;this.supportPoints.length>i;i+=1)if(t>this.supportPoints[i][0]-this.thickness&&this.supportPoints[i][0]+this.thickness>t&&e>this.supportPoints[i][1]-this.thickness&&this.supportPoints[i][1]+this.thickness>e)return!0;return!1},t.Curve.prototype.isInHandle=function(t,e){for(var i=this.values.points,s=0;i.length>s;s+=1)if(t>i[s][0]-this.handleSize&&i[s][0]+this.handleSize>t&&e>i[s][1]-this.handleSize&&i[s][1]+this.handleSize>e)return s;return null},t.Curve.prototype.isInROI=function(t,e){return t>this.ROILeft&&e>this.ROITop&&this.ROILeft+this.ROIWidth>t&&this.ROITop+this.ROIHeight>e?!0:!1},t.Curve.prototype.touch=t.Curve.prototype.dragstart=function(t,e){var i=this.values.points;if(this.isInROI(t,e)){var s;if(null!==(s=this.isInHandle(t,e))&&(this.handleClicked=s,0===s||s===i.length-1))return;if(this.isInCurve(t,e))return this.selectStart=!0,void 0}},t.Curve.prototype.xMonotoneFunc=function(t){t[0][0]>t[t.length-1][0]&&(t[0][0]>this.values.points[0][0]?t[0][0]=t[t.length-1][0]:t[t.length-1][0]=t[0][0])},t.Curve.prototype.drag=function(e,i){var s,r={};return null!==this.handleClicked?(s=t.GenericUtils.clone(this.values.points),this.isInROI(e,i)?(this.triggered=!1,s[this.handleClicked][0]=e,s[this.handleClicked][1]=i):(s[this.handleClicked][0]=e,s[this.handleClicked][1]=i,e>this.ROILeft+this.ROIWidth&&(s[this.handleClicked][0]=this.ROILeft+this.ROIWidth),this.ROILeft>e&&(s[this.handleClicked][0]=this.ROILeft),i>this.ROITop+this.ROIHeight&&(s[this.handleClicked][1]=this.ROITop+this.ROIHeight),this.ROITop>i&&(s[this.handleClicked][1]=this.ROITop)),this.whereHappened=[s[this.handleClicked][0],s[this.handleClicked][1]],r={slot:"points",value:s}):void 0},t.Curve.prototype.dragend=t.Curve.prototype.swipe=function(t,e){if(!(0>t&&0>e)){var i=this.drag(t,e);return this.handleClicked=null,i}},t.Curve.prototype.release=function(t,e){return this.handleClicked=null,this.selectStart===!0&&this.isInCurve(t,e)?(this.selectStart=!1,{slot:"selected",value:[t,e]}):void 0},t.Curve.prototype.hold=function(t,e){if(this.isInROI(t,e)&&this.isInCurve(t,e)){var i={slot:"held",value:[t,e]};return i}return void 0},t.Curve.prototype.doubletap=function(t,e){if(this.isInROI(t,e)){var i;if(null!==(i=this.isInHandle(t,e)))return{slot:"doubletap_h",value:[[t,e],i]};if(this.isInCurve(t,e))return{slot:"doubletap_c",value:[t,e]}}return void 0},t.Curve.prototype.setValue=function(e,i){var s=!0;if("points"===e)for(var r=this.values[e],n=0;i.length>n;n+=1){for(var o=0;i.length>o;o+=1)if(i[n][o]!==r[n][o]){s=!1;break}if(s===!1)break}else s=!1;this.xMonotone&&this.xMonotoneFunc(i),s||t.Curve.superclass.setValue.call(this,e,i)},t.Curve.prototype.refresh_CANVAS2D=function(t){if(this.isVisible===!0){var e=t.context,i={thickness:this.thickness,curveColor:this.curveColor,helperColor:this.helperColor,handleColor:this.handleColor,handleSize:this.handleSize,curveLabels:this.curveLabels};this.genericCurve(this.values.points,this.curveType),this.paintCurve(e),this.paintPoints(e,this.values.points,i)}},t.Curve.prototype.getCurvePoints=function(t){for(var e=1/t,i=[],s=0;1>=s;s+=e){var r=this[this.curveType].P(s,this.values.points);i.push(r)}return i},t.Curve.prototype.getCurveYPoints=function(t,e){e===void 0&&(e=1);for(var i=1/t,s=[],r=0;1>=r;r+=i){var n=this[this.curveType].P(r,this.values.points)[1]*e;s.push(n)}return s},t.Curve.prototype.getPoint=function(t){return this.supportPoints[t]},t.Curve.prototype.getnumPoints=function(){return this.supportPoints.length},t.Curve.prototype.halfcosine={P:function(t,e){var i=(1-Math.cos(t*Math.PI))/2,s=[0,0];return s[0]=e[0][0]+(e[1][0]-e[0][0])*t,s[1]=e[0][1]*(1-i)+e[1][1]*i,s}},t.Curve.prototype.smooth={P:function(t,e){var i=t*t*(3-2*t),s=[0,0];return s[0]=e[0][0]+(e[1][0]-e[0][0])*t,s[1]=e[0][1]+i*(e[1][1]-e[0][1]),s}},t.Curve.prototype.linear={P:function(t,e){var i=[0,0];return i[0]=e[0][0]+(e[1][0]-e[0][0])*t,i[1]=e[0][1]*(1-t)+e[1][1]*t,i}},t.Curve.prototype.cubic={P:function(t,e){var i=[0,0];i[0]=e[0][0]+(e[3][0]-e[0][0])*t;var s=t,r=t*t,n=e[3][1]-e[2][1]-e[0][1]+e[1][1],o=e[0][1]-e[1][1]-n,h=e[2][1]-e[0][1],a=e[1][1];return i[1]=n*s*r+o*r+h*s+a,i}},t.Curve.prototype.catmull={P:function(t,e){var i=[0,0];i[0]=e[0][0]+(e[3][0]-e[0][0])*t;var s=t,r=t*t,n=e[0][1],o=e[1][1],h=e[2][1],a=e[3][1],l=-.5*n+1.5*o-1.5*h+.5*a,u=n-2.5*o+2*h-.5*a,d=-.5*n+.5*h,c=o;return i[1]=l*s*r+u*r+d*s+c,i}},t.Curve.prototype.hermite={P:function(t,e,i,s){var r=[0,0];r[0]=e[0][0]+(e[3][0]-e[0][0])*t;var n,o,h,a,l,u,d,c,g=s||0,f=i||0,p=t,v=e[0][1],y=e[1][1],m=e[2][1],b=e[3][1];return h=p*p,a=h*p,n=(y-v)*(1+g)*(1-f)/2,n+=(m-y)*(1-g)*(1-f)/2,o=(m-y)*(1+g)*(1-f)/2,o+=(b-m)*(1-g)*(1-f)/2,l=2*a-3*h+1,u=a-2*h+p,d=a-h,c=-2*a+3*h,r[1]=l*y+u*n+d*o+c*m,r}},t.Curve.prototype.bezier={P:function(t,e){function i(t,e,i){var r=s;return"function"==typeof fact_lookup&&(r=fact_lookup),r(e)/(r(t)*r(e-t))*Math.pow(i,t)*Math.pow(1-i,e-t)}for(var s=function(t){for(var e=1,i=2;t>=i;i++)e*=i;return e},r=[0,0],n=e.length-1,o=0;n>=o;o++)r[0]+=e[o][0]*i(o,n,t),r[1]+=e[o][1]*i(o,n,t);return r}},t.Curve.prototype.genericCurve=function(t,e){function i(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function s(t){for(var e=0,s=0;t.length-1>s;s++)e+=i(t[s],t[s+1]);var r=1/e;return r}function r(t,e){for(var i=s(t),r=[],n=0;1>=n;n+=i){var o=e.P(n,t);r.push(o)}return r}this.supportPoints=r(t,this[e])},t.Curve.prototype.paintHandle=function(t,e,i){i===!0?this.paintPoint(t,e,this.terminalPointStyle,this.terminalPointFill,this.terminalPointColor,this.terminalPointSize):this.paintPoint(t,e,this.midPointStyle,this.midPointFill,this.midPointColor,this.midPointSize)},t.Curve.prototype.paintPoint=function(t,e,i,s,r,n){if("rect"===i)t.save(),t.strokeStyle=r,t.lineWidth=Math.round(n/5),t.strokeRect(e[0]-Math.round(n/2),e[1]-Math.round(n/2),n,n),null!==s&&(t.fillStyle=s,t.fillRect(e[0]-Math.ceil(n/2)+Math.floor(t.lineWidth/2),e[1]-Math.ceil(n/2)+Math.floor(t.lineWidth/2),n-t.lineWidth+1,n-t.lineWidth+1)),t.restore();else if("circle"===i)t.save(),t.beginPath(),t.strokeStyle=r,t.lineWidth=Math.round(n/5),t.arc(e[0],e[1],n,0,2*Math.PI,!1),null!==s&&(t.fillStyle=s,t.fill()),t.stroke(),t.restore();else if("none"!==i)throw"Unknown handle style: "+i},t.Curve.prototype.paintPoints=function(t){var e,i=this.values.points;for(t.save(),t.strokeStyle=this.helperColor,t.beginPath(),t.moveTo(i[0][0],i[0][1]),e=1;i.length>e;e++)t.lineTo(i[e][0],i[e][1]);for(t.stroke(),e=0;i.length>e;e++){var s=!1;(0===e||e===i.length-1)&&(s=!0);var r=this.paintTerminalPoints;s===!0?("all"===r||"first"===r&&0===e||"last"===r&&e===i.length-1)&&(this.paintHandle(t,i[e],s),this.curveLabels&&t.fillText(this.ID+" ("+e+")"+" ["+i[e][0]+","+i[e][1]+"]",i[e][0],i[e][1]-10)):(this.paintHandle(t,i[e],s),this.curveLabels&&t.fillText(this.ID+" ("+e+")"+" ["+i[e][0]+","+i[e][1]+"]",i[e][0],i[e][1]-10)),t.restore()}},t.Curve.prototype.paintCurve=function(t){var e=this.supportPoints,i=this.thickness,s=this.curveColor;t.save(),t.lineWidth=i,t.strokeStyle=s,t.beginPath(),t.moveTo(e[0][0],e[0][1]);for(var r=1;e.length>r;r++)t.lineTo(e[r][0],e[r][1]);t.stroke(),t.restore()},t.Bar=function(t){arguments.length&&this.getready(t)},t.extend(t.Bar,t.UIElement),t.Bar.prototype.getready=function(e){t.Bar.superclass.getready.call(this,e),this.values={barPos:[],dragStart:[],dragEnd:[]},this.defaultSlot="barPos",this.setWidth(e.width),this.setHeight(e.height),this.orientation=e.orientation||0,this.barColor=e.barColor||"black",this.thickness=e.thickness||1},t.Bar.prototype.isInROI=function(t,e){return t>this.ROILeft&&e>this.ROITop&&this.ROILeft+this.ROIWidth>t&&this.ROITop+this.ROIHeight>e?!0:!1},t.Bar.prototype.isInROIX=function(t){return t>this.ROILeft&&this.ROILeft+this.ROIWidth>t},t.Bar.prototype.isInROIY=function(t){return t>this.ROITop&&this.ROITop+this.ROIHeight>t},t.Bar.prototype.commonDrag=function(t,e){var i,s=this.values.barPos;if(0===this.orientation){if(!this.isInROIY(e))return void 0;i=[t-this.xOrigin,s[1]],i[0]>this.width&&(i[0]=this.width),0>i[0]&&(i[0]=0)}else if(1===this.orientation){if(!this.isInROIY(t))return void 0;i=[s[0],e-this.yOrigin],i[1]>this.height&&(i[1]=this.height),0>i[1]&&(i[1]=0)}return i},t.Bar.prototype.touch=function(t,e){if(this.isInROI(t,e)){this.started=!0;var i=this.commonDrag(t,e);if(i!==void 0)return{slot:"barPos",value:i}}return void 0},t.Bar.prototype.drag=function(t,e){if(this.started){var i=this.commonDrag(t,e);if(i!==void 0)return{slot:"barPos",value:i}}return void 0},t.Bar.prototype.dragend=t.Bar.prototype.swipe=function(t,e){if(this.started){this.started=!1;var i=this.commonDrag(t,e);if(i!==void 0)return[{slot:"barPos",value:i},{slot:"dragEnd",value:[t-this.xOrigin,e-this.yOrigin]}]}return void 0},t.Bar.prototype.dragstart=function(t,e){return this.isInROI(t,e)?{slot:"dragStart",value:[t-this.xOrigin,e-this.yOrigin]}:void 0},t.Bar.prototype.setValue=function(t,e){"barPos"==t?(e[0]<=this.width&&(this.values.barPos[0]=e[0]),e[1]<=this.height&&(this.values.barPos[1]=e[1])):this.values[t]=e},t.Bar.prototype.refresh_CANVAS2D=function(t){if(this.isVisible===!0){var e=t.context;if(e.lineWidth=this.thickness,e.strokeStyle=this.barColor,e.beginPath(),0===this.orientation){var i=this.xOrigin+this.values.barPos[0];e.moveTo(i,this.yOrigin+this.height),e.lineTo(i,this.yOrigin)}else 1===this.orientation&&(e.moveTo(this.xOrigin+this.width,this.yOrigin+this.values.barPos[1]),e.lineTo(this.xOrigin,this.yOrigin+this.values.barPos[1]));e.stroke(),e.closePath()}},t.Button=function(t){arguments.length&&this.getready(t)},t.extend(t.Button,t.UIElement),t.Button.prototype.getready=function(e){if(void 0===e)throw Error("Error: args is undefined!");if(t.Button.superclass.getready.call(this,e),this.values={buttonvalue:0},this.defaultSlot="buttonvalue",this.triggered=!1,this.mode=e.mode||"persistent",this.imagesArray=e.imagesArray,1>this.imagesArray.length)throw Error("Invalid images array length, "+this.imagesArray.length);this.nButtons=this.imagesArray.length;for(var i=0;this.nButtons>i;i+=1)this.setWidth(this.imagesArray[i].width),this.setHeight(this.imagesArray[i].height)},t.Button.prototype.isInROI=function(t,e){return t>=this.ROILeft&&e>=this.ROITop&&this.ROILeft+this.ROIWidth>=t&&this.ROITop+this.ROIHeight>=e?!0:!1},t.Button.prototype.touch=function(t,e){if(this.isInROI(t,e)){if(this.triggered=!0,"persistent"===this.mode)return void 0;if("immediate"===this.mode){var i=(this.values.buttonvalue+1)%this.nButtons;return{slot:"buttonvalue",value:i}}}return void 0},t.Button.prototype.release=function(t,e){var i=0,s={};if("persistent"===this.mode){if(this.triggered&&this.isInROI(t,e))return i=(this.values.buttonvalue+1)%this.nButtons,s={slot:"buttonvalue",value:i},this.triggered=!1,s}else if("immediate"===this.mode&&this.triggered)return i=(this.values.buttonvalue-1)%this.nButtons,s={slot:"buttonvalue",value:i},this.triggered=!1,s;return void 0},t.Button.prototype.mouseout=function(t,e){return"immediate"===this.mode?this.release(t,e):void 0},t.Button.prototype.setValue=function(e,i){0>i||i>this.nButtons||t.Button.superclass.setValue.call(this,e,i)},t.Button.prototype.refresh_CANVAS2D=function(t){this.isVisible===!0&&t.context.drawImage(this.imagesArray[this.values.buttonvalue],this.xOrigin,this.yOrigin)},t.Button.prototype.setStatesNumber=function(t){this.nButtons=t},t.Button.prototype.getStatesNumber=function(){return this.nButtons},t.Background=function(t){arguments.length&&this.getready(t)},t.extend(t.Background,t.UIElement),t.Background.prototype.getready=function(e){if(e===void 0)throw Error("Error: args is undefined!");t.Background.superclass.getready.call(this,e),this.values={selected:[],held:[],doubletap:[],tap:[]},this.defaultSlot="selected",this.image=e.image,this.setWidth(this.image.width),this.setHeight(this.image.height)},t.Background.prototype.GetImage=function(){return this.image},t.Background.prototype.isInROI=function(t,e){return t>this.ROILeft&&e>this.ROITop?this.ROILeft+this.ROIWidth>t&&this.ROITop+this.ROIHeight>e:!1},t.Background.prototype.touch=function(t,e){return this.isInROI(t,e)&&(this.triggered=!0),void 0},t.Background.prototype.release=function(t,e){return this.triggered&&this.isInROI(t,e)?(this.triggered=!1,{slot:"selected",value:[t,e]}):void 0},t.Background.prototype.refresh_CANVAS2D=function(t){this.isVisible===!0&&t.context.drawImage(this.image,this.xOrigin,this.yOrigin)},t.ClickBar=function(t){arguments.length&&this.getready(t)},t.extend(t.ClickBar,t.UIElement),t.ClickBar.prototype.getready=function(e){t.ClickBar.superclass.getready.call(this,e),this.values={barvalue:null},this.prevValue=null,this.defaultSlot="barvalue",this.color=e.color||"orangered",this.lightColor=e.diffColor||"darkorange",this.lighterColor=e.prevColor||"orange",this.lightestColor=e.prevColor||"#FFBE00",this.landingHeight=e.landingHeight||20;var i=e.height||0,s=e.width||0;this.maxValue=e.maxValue||1,this.minValue=e.minValue||0,this.setWidth(s),this.setHeight(i)},t.ClickBar.prototype.isInROI=function(t,e){return t>=this.ROILeft&&e>=this.ROITop-this.landingHeight&&this.ROILeft+this.ROIWidth>=t&&this.ROITop+this.ROIHeight+this.landingHeight>=e?!0:!1},t.ClickBar.prototype.calculateValue=function(t,e){var i=e-this.yOrigin,s=1-i/this.height;return s>this.maxValue&&(s=this.maxValue),this.minValue>s&&(s=this.minValue),s},t.ClickBar.prototype.touch=function(t,e){if(this.isInROI(t,e)){this.triggered=!0;var i=this.calculateValue(t,e);if(i===this.values.barvalue)return;return{slot:"barvalue",value:i}}},t.ClickBar.prototype.drag=function(t,e){if(this.isInROI(t,e)){this.triggered||(this.prevValue=this.values.barvalue,this.triggered=!0);var i=this.calculateValue(t,e);if(i===this.values.barvalue)return;return{slot:"barvalue",value:i}}},t.ClickBar.prototype.release=function(){return this.triggered=!1,this.prevValue!==this.values.barvalue?(this.prevValue=this.values.barvalue,{slot:"barvalue",value:this.values.barvalue}):void 0},t.ClickBar.prototype.setValue=function(e,i){t.ClickBar.superclass.setValue.call(this,e,i)},t.ClickBar.prototype.refresh_CANVAS2D=function(t){this.isVisible===!0&&(this.triggered?this.values.barvalue<this.prevValue?(t.context.fillStyle=this.lightestColor,t.context.fillRect(this.xOrigin,this.yOrigin+(1-this.prevValue)*this.height,this.width,this.prevValue*this.height),t.context.fillStyle=this.lightColor,t.context.fillRect(this.xOrigin,this.yOrigin+(1-this.values.barvalue)*this.height,this.width,this.values.barvalue*this.height)):(t.context.fillStyle=this.lightColor,t.context.fillRect(this.xOrigin,this.yOrigin+(1-this.values.barvalue)*this.height,this.width,this.values.barvalue*this.height),t.context.fillStyle=this.lighterColor,t.context.fillRect(this.xOrigin,this.yOrigin+(1-this.prevValue)*this.height,this.width,this.prevValue*this.height)):(t.context.fillStyle=this.color,t.context.fillRect(this.xOrigin,this.yOrigin+(1-this.values.barvalue)*this.height,this.width,this.values.barvalue*this.height)))},t.Gauge=function(t){arguments.length&&this.getready(t)},t.extend(t.Gauge,t.UIElement),t.Gauge.prototype.getready=function(e){if(e===void 0)throw Error("Error: args is undefined!");
t.Gauge.superclass.getready.call(this,e),this.values={gaugevalue:null,midgaugevalue:null,selected:[],held:[],doubletap:[],tap:[]},this.defaultSlot="gaugevalue",this.prevValue=this.values.gaugevalue,this.setWidth(e.width),this.setHeight(e.height),this.color=e.color||["#47D147","#70DB70","#99E699"],this.bgColor=e.bgColor||"#222",this.radius=e.radius||(this.width<this.height?Math.floor(this.width/2):Math.floor(this.height/2)),this.thickness=e.thickness||(this.width<this.height?Math.floor(this.width/3):Math.floor(this.height/3))},t.Gauge.prototype.isInROI=function(){return!0},t.Gauge.prototype.calculateAngle=function(e,i){var s=this.xOrigin+this.width/2,r=this.yOrigin+this.height/2,n=Math.atan2(e-s,i-r),o=n*(180/Math.PI);return o=180-o,t.MathUtils.linearRange(0,360,0,1,Math.floor(o))},t.Gauge.prototype.touch=function(e,i){var s=t.MathUtils.distance(e,i,this.xOrigin+this.width/2,this.yOrigin+this.height/2);if(s>this.radius-this.thickness/2&&this.radius+this.thickness/2>s){this.triggered=!0;var r=this.calculateAngle(e,i);return this.prevValue=this.values.gaugevalue,{slot:"gaugevalue",value:r}}return void 0},t.Gauge.prototype.drag=function(t,e){if(this.triggered){var i=this.calculateAngle(t,e);return{slot:"gaugevalue",value:i}}},t.Gauge.prototype.release=function(){return this.triggered?(this.triggered=!1,this.prevValue=this.values.gaugevalue,{slot:"gaugevalue",value:this.values.gaugevalue}):void 0},t.Gauge.prototype.setValue=function(e,i){t.Gauge.superclass.setValue.call(this,e,i)},t.Gauge.prototype.refresh_CANVAS2D=function(t){if(this.isVisible===!0){var e=t.context;e.beginPath(),this.drawGauge(e,1,this.bgColor),this.triggered?this.values.gaugevalue<=this.prevValue?(this.drawGauge(e,this.prevValue,this.color[2]),this.drawGauge(e,this.values.gaugevalue,this.color[1])):(this.drawGauge(e,this.values.gaugevalue,this.color[2]),this.drawGauge(e,this.prevValue,this.color[1])):this.drawGauge(e,this.values.gaugevalue,this.color[0])}},t.Gauge.prototype.drawGauge=function(e,i,s){var r,n;r=t.MathUtils.linearRange(0,1,0,360,i),n=r*Math.PI/180,e.beginPath(),e.strokeStyle=s,e.lineWidth=this.thickness,1===i?e.arc(this.xOrigin+this.width/2,this.yOrigin+this.height/2,this.radius,0,2*Math.PI,!1):e.arc(this.xOrigin+this.width/2,this.yOrigin+this.height/2,this.radius,-90*Math.PI/180,n-90*Math.PI/180,!1),e.stroke()},t.Grid=function(t){arguments.length&&this.getready(t)},t.extend(t.Grid,t.UIElement),t.Grid.prototype.getready=function(e){if(void 0===e)throw Error("Error: args is undefined!");if(t.Grid.superclass.getready.call(this,e),this.setWidth(e.width),this.setHeight(e.height),this.values={selected:[]},this.defaultSlot="",this.triggered=!1,this.rows=e.rows||4,this.columns=e.columns||4,this.style=e.style||"line",this.lineColor=e.lineColor||"#eee",this.bgColor=e.bgColor||"white",this.dashArray=e.dashArray,this.lineWidth=e.lineWidth||.1,0>this.rows||0>this.columns)throw Error("Invalid number of row / columns "+this.rows+" / "+this.columns)},t.Grid.prototype.isInROI=function(t,e){return t>=this.ROILeft&&e>=this.ROITop&&this.ROILeft+this.ROIWidth>=t&&this.ROITop+this.ROIHeight>=e?!0:!1},t.Grid.prototype.touch=function(t,e){return this.isInROI(t,e)&&(this.triggered=!0),void 0},t.Grid.prototype.release=function(t,e){return this.triggered&&this.isInROI(t,e)?(this.triggered=!1,{slot:"selected",value:[t,e]}):void 0},t.Grid.prototype.setValue=function(e,i){t.Grid.superclass.setValue.call(this,e,i)},t.Grid.prototype.refresh_CANVAS2D=function(t){if(this.isVisible===!0){var e=t.context,i=Math.floor(this.height/this.rows),s=Math.floor(this.width/this.columns);e.fillStyle=this.bgColor,e.fillRect(this.xOrigin,this.yOrigin,this.width,this.height),e.beginPath(),e.lineWidth=this.lineWidth;for(var r=this.xOrigin+0;this.xOrigin+this.width>r;r+=s)"line"===this.style?(e.moveTo(r,this.yOrigin),e.lineTo(r,this.yOrigin+this.height)):"dashed"===this.style&&e.dashedLine(r,this.yOrigin,r,this.yOrigin+this.height,this.dashArray);for(var n=this.yOrigin+0;this.yOrigin+this.height>n;n+=i)"line"===this.style?(e.moveTo(this.xOrigin,n),e.lineTo(this.xOrigin+this.width,n)):"dashed"===this.style&&e.dashedLine(this.xOrigin,n,this.xOrigin+this.width,n,this.dashArray);e.strokeStyle=this.lineColor,e.stroke(),e.closePath()}},t.Knob=function(t){arguments.length&&this.getready(t)},t.extend(t.Knob,t.UIElement),t.Knob.prototype.getready=function(e){if(void 0===e)throw Error("Error: specArgs is undefined!");t.Knob.superclass.getready.call(this,e),this.values={knobvalue:0},this.defaultSlot="knobvalue",this.sensitivity=e.sensitivity||2e3,this.imagesArray=e.imagesArray||null,this.knobMethod=e.knobMethod||"atan",this.bottomAngularOffset=e.bottomAngularOffset;var i=0,s=0;if(1>this.imagesArray.length)throw Error("Invalid images array length, "+this.imagesArray.length);if(1==this.imagesArray.length)i=e.tileWidth,s=e.tileHeight,this.imageNum=e.imageNum;else{this.imageNum=this.imagesArray.length;for(var r=0,n=this.imagesArray.length;n>r;r+=1)this.imagesArray[r].width>i&&(i=this.imagesArray[r].width),this.imagesArray[r].height>s&&(s=this.imagesArray[r].height)}this.setWidth(i),this.setHeight(s)},t.Knob.prototype.getImageNum=function(){return 0>this.values.knobvalue||this.values.knobvalue>1?void 0:Math.round(this.values.knobvalue*(this.imageNum-1))},t.Knob.prototype.getImage=function(){var t=this.getImageNum();return this.imagesArray[t]},t.Knob.prototype.calculateAngle=function(e,i){var s=this.xOrigin+this.width/2,r=this.yOrigin+this.height/2,n=Math.atan2(e-s,i-r);0>n&&(n+=2*Math.PI);var o=n*(180/Math.PI);o=360-o,this.bottomAngularOffset!==void 0&&(o=t.MathUtils.linearRange(0,360,-this.bottomAngularOffset,360+this.bottomAngularOffset,o),0>o&&(o=0),o>360&&(o=360));var h=t.MathUtils.linearRange(0,360,0,1,Math.floor(o));return h},t.Knob.prototype.isInROI=function(t,e){return t>this.ROILeft&&e>this.ROITop&&this.ROILeft+this.ROIWidth>t&&this.ROITop+this.ROIHeight>e?!0:!1},t.Knob.prototype.touch=function(t,e){var i=this.isInROI(t,e);if(i&&(this.start_x=t,this.start_y=e,"atan"===this.knobMethod)){var s=this.calculateAngle(t,e);return{slot:"knobvalue",value:s}}return void 0},t.Knob.prototype.release=function(){return this.start_x=void 0,this.start_y=void 0,void 0},t.Knob.prototype.drag=function(t,e){var i;if("updown"===this.knobMethod){if(void 0!==this.start_x&&void 0!==this.start_y){var s,r,n;return s=e-this.start_y,r=this.values.knobvalue,n=r-s/this.sensitivity,n>1&&(n=1),0>n&&(n=0),i={slot:"knobvalue",value:n}}}else if("atan"===this.knobMethod&&void 0!==this.start_x&&void 0!==this.start_y){var o=this.calculateAngle(t,e);return i={slot:"knobvalue",value:o}}return void 0},t.Knob.prototype.setValue=function(e,i){0>i||i>1||t.Knob.superclass.setValue.call(this,e,i)},t.Knob.prototype.refresh_CANVAS2D=function(t){if(this.isVisible===!0)if(this.imagesArray.length>1){var e=this.getImageNum();t.context.drawImage(this.imagesArray[e],this.xOrigin,this.yOrigin)}else if(1==this.imagesArray.length){var i=0,s=this.height*this.getImageNum();t.context.drawImage(this.imagesArray[0],i,s,this.width,this.height,this.xOrigin,this.yOrigin,this.width,this.height)}},t.Label=function(t){arguments.length&&this.getready(t)},t.extend(t.Label,t.UIElement),t.Label.prototype.getready=function(e){t.Label.superclass.getready.call(this,e),this.values={labelvalue:""},this.defaultSlot="labelvalue",this.textColor=e.textColor||"black",this.setWidth(e.width),this.setHeight(e.height)},t.Label.prototype.isInROI=function(t,e){return t>this.ROILeft&&e>this.ROITop&&this.ROILeft+this.ROIWidth>t&&this.ROITop+this.ROIHeight>e?!0:!1},t.Label.prototype.setValue=function(e,i){t.Label.superclass.setValue.call(this,e,i)},t.Label.prototype.refresh_CANVAS2D=function(t){this.isVisible===!0&&(this.objParms!==void 0&&(this.objParms.textBaseline!==void 0&&(t.context.textBaseline=this.objParms.textBaseline),this.objParms.textAlign!==void 0&&(t.context.textAlign=this.objParms.textAlign),this.objParms.font!==void 0&&(t.context.font=this.objParms.font)),t.context.fillStyle=this.textColor,t.context.fillText(this.values.labelvalue,this.xOrigin,this.yOrigin))},t.RotKnob=function(t){arguments.length&&this.getready(t)},t.extend(t.RotKnob,t.UIElement),t.RotKnob.prototype.getready=function(e){if(e===void 0)throw"RotKnob constructor: args is undefined!";t.RotKnob.superclass.getready.call(this,e),this.values={knobvalue:0,realknobvalue:0},this.defaultSlot="knobvalue",this.initAngValue=void 0===e.initAngValue?0:e.initAngValue,this.moveDirection="anticlockwise"==e.moveDirection?-1:1,this.startAngValue=e.startAngValue||0,this.stopAngValue=e.stopAngValue||360,this.angSteps=e.angSteps;var i=e.sensitivity||2e3;this.sensitivity=Math.round(i/360*Math.abs(this.stopAngValue-this.startAngValue)),this.knobMethod=e.knobMethod||"atan",this.image=e.image,this.setWidth(this.image.width),this.setHeight(this.image.height),this.start_x=null,this.start_y=null},t.RotKnob.prototype.getRotateAmount=function(){if(0>this.values.knobvalue||this.values.knobvalue>1)return void 0;var t=360*this.values.knobvalue,e=360-(t*(this.startAngValue-this.stopAngValue)/360+this.stopAngValue)%360,i=(360-this.initAngValue+e)%360;return i*Math.PI/180},t.RotKnob.prototype.getRangedAmount=function(e){var i=this.stopAngValue-this.initAngValue,s=this.startAngValue-this.initAngValue;e>this.initAngValue&&0>s&&(e=-(360-e));var r=t.MathUtils.linearRange(s,i,0,1,e);return 0>r&&(r=0),r>1&&(r=1),r},t.RotKnob.prototype.isInROI=function(t,e){return t>this.ROILeft&&e>this.ROITop&&this.ROILeft+this.ROIWidth>t&&this.ROITop+this.ROIHeight>e?!0:!1},t.RotKnob.prototype.calculateAngle=function(t,e){var i=this.xOrigin+this.width/2,s=this.yOrigin+this.height/2,r=Math.atan2(t-i,e-s),n=r*(180/Math.PI);n=180-n;var o=n-this.initAngValue;return 0>o&&(o=360+o),(n-this.initAngValue)%360,this.getRangedAmount(Math.floor(o))},t.RotKnob.prototype.touch=function(t,e){var i=this.isInROI(t,e);if(i&&(this.start_x=t,this.start_y=e,"atan"===this.knobMethod)){var s=this.calculateAngle(t,e);return{slot:"knobvalue",value:s}}return void 0},t.RotKnob.prototype.release=function(){return this.start_x=null,this.start_y=null,void 0},t.RotKnob.prototype.drag=function(t,e){var i;if("updown"===this.knobMethod){if(null!==this.start_x&&null!==this.start_y){var s,r,n;return s=e-this.start_y,r=this.values.realknobvalue,n=r-s/this.sensitivity*this.moveDirection,n>1&&(n=1),0>n&&(n=0),i={slot:"knobvalue",value:n}}}else if("atan"===this.knobMethod&&this.isInROI(t,e)&&null!==this.start_x&&null!==this.start_y){var o=this.calculateAngle(t,e);return i={slot:"knobvalue",value:o}}return void 0},t.RotKnob.prototype.setValue=function(e,i){var s;if(!(0>i||i>1)){if(void 0===this.values[e])throw Error("Slot "+e+" not present or value undefined");if(i!==this.values[e]&&i!==this.values["real"+e]){if(this.values["real"+e]=i,void 0!==this.angSteps){var r=1/this.angSteps;if(s=Math.floor(i/r)*r,s===this.values[e])return}else s=i;t.RotKnob.superclass.setValue.call(this,e,s)}}},t.RotKnob.prototype.refresh_CANVAS2D=function(e){if(this.isVisible===!0){var i=this.getRotateAmount();t.CanvasUtils.drawRotate(e.context,{image:this.image,x:this.xOrigin,y:this.yOrigin,rot:i})}},t.Slider=function(t){arguments.length&&this.getready(t)},t.extend(t.Slider,t.UIElement),t.Slider.prototype.getready=function(e){if(e===void 0)throw"Slider error: args is undefined!";t.Slider.superclass.getready.call(this,e),this.values={slidervalue:0},this.defaultSlot="slidervalue",this.width=0,this.height=0,this.sliderImage=e.sliderImg,this.knobImage=e.knobImg,this.type=e.type,"horizontal"!==this.type&&"vertical"!==this.type&&(this.type="vertical"),this.calculateDimensions()},t.Slider.prototype.getKnobPosition=function(){var t;if(0>this.values.slidervalue||this.values.slidervalue>1)return void 0;switch(this.type){case"horizontal":t=Math.round(this.values.slidervalue*this.width+this.zeroLimit);break;case"vertical":t=Math.round(this.values.slidervalue*this.height+this.zeroLimit);break;default:throw Error("Error: Slider orientation is undefined!")}return t},t.Slider.prototype.isInROI=function(t,e){switch(this.type){case"horizontal":if(t>this.getKnobPosition()&&e>this.ROITop&&this.getKnobPosition()+this.kWidth>t&&this.ROITop+this.kHeight>e)return!0;break;case"vertical":if(e>this.getKnobPosition()&&t>this.ROILeft&&this.getKnobPosition()+this.kHeight>e&&this.ROILeft+this.kWidth>t)return!0;break;default:throw Error("Error: Slider orientation is undefined!")}return!1},t.Slider.prototype.touch=function(t,e){if(this.isInROI(t,e))switch(this.triggered=!0,this.type){case"horizontal":this.drag_offset=t-this.getKnobPosition();break;case"vertical":this.drag_offset=e-this.getKnobPosition();break;default:throw Error("Error: Slider orientation is undefined!")}return void 0},t.Slider.prototype.release=function(){return this.triggered=!1,this.drag_offset=void 0,void 0},t.Slider.prototype.drag=function(t,e){if(this.triggered===!0){var i,s;switch(this.type){case"horizontal":i=(t-this.zeroLimit-this.drag_offset)/this.width;break;case"vertical":i=(e-this.zeroLimit-this.drag_offset)/this.height;break;default:throw Error("Error: Slider orientation is undefined!")}return i>1&&(i=1),0>i&&(i=0),s={slot:"slidervalue",value:i}}return void 0},t.Slider.prototype.setValue=function(e,i){0>i||i>1||t.Slider.superclass.setValue.call(this,e,i)},t.Slider.prototype.refresh_CANVAS2D=function(t){if(this.isVisible===!0)switch(t.context.drawImage(this.sliderImage,this.xOrigin,this.yOrigin),this.type){case"horizontal":t.context.drawImage(this.knobImage,this.getKnobPosition(),this.yOrigin);break;case"vertical":t.context.drawImage(this.knobImage,this.xOrigin,this.getKnobPosition());break;default:throw Error("Error: Slider orientation unknown: ",this.type)}},t.Slider.prototype.calculateDimensions=function(){switch(this.kWidth=this.knobImage.width,this.kHeight=this.knobImage.height,this.setWidth(this.sliderImage.width),this.setHeight(this.sliderImage.height),this.type){case"horizontal":this.totalStride=this.width+this.kWidth,this.additionalEndSpace=Math.round(this.kWidth/2),this.zeroLimit=this.xOrigin-this.additionalEndSpace,this.oneLimit=this.xOrigin+this.width+this.additionalEndSpace;break;case"vertical":this.totalStride=this.height+this.kHeight,this.additionalEndSpace=Math.round(this.kHeight/2),this.zeroLimit=this.yOrigin-this.additionalEndSpace,this.oneLimit=this.yOrigin+this.height+this.additionalEndSpace;break;default:throw Error("Error: Slider orientation is undefined!")}},t.Slider.prototype.setGraphicWrapper=function(e){t.Slider.superclass.setGraphicWrapper.call(this,e),this.drawClass=e.initObject([{objName:"drawImage",objParms:this.objParms}])},t.Wavebox=function(t){arguments.length&&this.getready(t)},t.extend(t.Wavebox,t.UIElement),t.Wavebox.prototype.getready=function(e){t.Wavebox.superclass.getready.call(this,e),this.values={waveboxposition:0,startsample:0,endsample:null,waveboxsignal:[],xPos:0,yPos:0},this.defaultSlot="waveboxposition",this.setWidth(e.width),this.setHeight(e.height),this.binMethod=e.binMethod||"minmax",this.orientation=e.orientation||0,this.waveColor=e.waveColor||"black"},t.Wavebox.prototype.isInROI=function(t,e){return t>this.ROILeft&&e>this.ROITop&&this.ROILeft+this.ROIWidth>t&&this.ROITop+this.ROIHeight>e?!0:!1},t.Wavebox.prototype.touch=function(t,e){return this.isInROI(t,e)&&(this.triggered=!0),void 0},t.Wavebox.prototype.release=function(t,e){var i={};return this.triggered&&this.isInROI(t,e)?(0===this.orientation?i={slot:"xPos",value:t}:1===this.orientation&&(i={slot:"yPos",value:e}),this.triggered=!1,i):void 0},t.Wavebox.prototype.setValue=function(t,e){if(void 0===this.values[t])throw Error("Slot "+t+" not present or value undefined");if(this.values[t]!==e){if("startsample"===t||"endsample"===t){if(0>e)throw Error("Error: Trying to set "+t+" less than 0: "+e);if(this.values.waveboxsignal!==void 0&&e>this.values.waveboxsignal.length)throw Error("Error: Trying to set "+t+" bigger than signal length: "+e+" > "+this.values.waveboxsignal.length)}if("startsample"===t&&e>this.values.endsample)throw Error("Error: Trying to set startsample > endsample: "+e+" > "+this.values.endsample);if("endsample"===t&&this.values.startsample>e)throw Error("Error: Trying to set endsample < startsample: "+e+" < "+this.values.startsample);this.values[t]=e,"waveboxsignal"===t&&(this.values.endsample=this.values.waveboxsignal.length,this.values.startsample=0),"xPos"==t&&this.width>=e&&(this.values.xPos=e),"yPos"==t&&this.height>=e&&(this.values.yPos=e)}},t.Wavebox.prototype.refresh_CANVAS2D=function(t){if(this.isVisible===!0){var e=t.context;e.fillStyle=this.waveColor;var i,s,r,n,o=this.width,h=this.height;1===this.orientation&&(o=this.height,h=this.width);var a;"minmax"==this.binMethod?a=this.calculateBinMix:"none"==this.binMethod&&(a=this.calculateBinNone);var l;for(r=parseInt((this.values.endsample-this.values.startsample)/o,10),e.beginPath(),0===this.orientation?e.moveTo(this.xOrigin,.5*h+this.yOrigin):1===this.orientation&&e.moveTo(this.xOrigin+.5*h,this.yOrigin),l=0;o>l;l+=1)n=a(l,r,this.values),0===this.orientation?(i=h-(n.max+1)*h/2+this.yOrigin,s=l+this.xOrigin):1===this.orientation&&(i=l+this.yOrigin,s=h-(n.max+1)*h/2+this.xOrigin),e.lineTo(s,i);for(0===this.orientation?e.lineTo(o+this.xOrigin,.5*h+this.yOrigin):1===this.orientation&&e.lineTo(.5*h+this.xOrigin,o+this.yOrigin),e.fill(),e.closePath(),e.beginPath(),0===this.orientation?e.moveTo(this.xOrigin,.5*h+this.yOrigin):1===this.orientation&&e.moveTo(this.xOrigin+.5*h,this.yOrigin),l=0;o>l;l+=1)n=a(l,r,this.values),0===this.orientation&&(i=h-(n.min+1)*h/2+this.yOrigin,s=l+this.xOrigin),1===this.orientation&&(i=l+this.yOrigin,s=h-(n.min+1)*h/2+this.xOrigin),e.lineTo(s,i);0===this.orientation?e.lineTo(o+this.xOrigin,.5*h+this.yOrigin):1===this.orientation&&e.lineTo(.5*h+this.xOrigin,o+this.yOrigin),e.fill(),e.closePath()}},t.Wavebox.prototype.calculateBinMix=function(t,e,i){var s=i.waveboxsignal,r=i.startsample+t*e,n=i.startsample+(t+1)*e;n>i.endsample&&(n=i.endsample);for(var o=s[r],h=s[r],a=1;e>a;a++)o>s[r+a]&&(o=s[r+a]),s[r+a]>h&&(h=s[r+a]);return{max:h,min:o}},t.Wavebox.prototype.calculateBinNone=function(t,e,i){var s=i.startsample+t*e,r=parseInt(e/2,10),n=i.waveboxsignal[s+r];return{max:n,min:-n}},t.Wavebox.prototype.calculateBinAvg=function(t,e){var i=this.values.waveboxsignal,s=this.values.startsample+t*e,r=s+(t+1)*e;r>this.values.endsample&&(r=this.values.endsample);for(var n=i.subarray(s,r),o=0,h=n.length,a=0;h-1>a;a++)o=(n[a+1]+a*o)/(a+1);return o},t.ENGINE={},t.ENGINE.engineFactory=function(t,e){function i(t){this.reset=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},this.canvas=t,this.context=t.getContext("2d"),this.type="CANVAS2D",this.getContext=function(){return this.context},this.getCanvas=function(){return this.canvas}}switch(t){case"CANVAS2D":if(void 0!==e.target)return new i(e.target);throw"Engine: args is undefined";case"ANOTHERTYPE":throw"Engine type not recognized: "+t;default:throw"Engine type not recognized: "+t}};var e=window.CanvasRenderingContext2D&&CanvasRenderingContext2D.prototype;if(e.lineTo&&(e.dashedLine=function(t,e,i,s,r){r||(r=[10,5]),this.save();var n=i-t,o=s-e,h=Math.sqrt(n*n+o*o),a=Math.atan2(o,n);this.translate(t,e),this.moveTo(0,0),this.rotate(a);var l=r.length,u=0,d=!0;for(t=0;h>t;)t+=r[u++%l],t>h&&(t=h),d?this.lineTo(t,0):this.moveTo(t,0),d=!d;this.restore()}),t.OSC={},t.OSC.Message=function(e){this.address=e,this.typetags="",this.args=[];for(var i=1;arguments.length>i;i++){var s=arguments[i];switch(typeof s){case"object":if(!s.typetag)throw Error("don't know how to encode object "+s);this.typetags+=s.typetag,this.args.push(s);break;case"number":Math.floor(s)==s?(this.typetags+=t.OSC.TInt.prototype.typetag,this.args.push(new t.OSC.TInt(Math.floor(s)))):(this.typetags+=t.OSC.TFloat.prototype.typetag,this.args.push(new t.OSC.TFloat(s)));break;case"string":this.typetags+=t.OSC.TString.prototype.typetag,this.args.push(new t.OSC.TString(s));break;default:throw Error("don't know how to encode "+s)}}},t.OSC.Message.prototype={toBinary:function(){var e=new t.OSC.TString(this.address),i=[],s=[];if(s=e.encode(),i=i.concat(s),this.typetags){var r=new t.OSC.TString(","+this.typetags);s=r.encode(),i=i.concat(s);for(var n=0;this.args.length>n;n++)s=this.args[n].encode(),i=i.concat(s)}return i}},t.OSC.Bundle=function(e,i){t.OSC.Message.call(this,e),this.timetag=i||0},t.OSC.Bundle.prototype.append=function(e){var i;if(e instanceof Message)i=new t.OSC.TBlob(e.toBinary());else{var s=new t.OSC.Message(this.address);"Object"==typeof e?(e.addr&&(s.address=e.addr),e.args&&s.append.apply(e.args)):s.append(e),i=new t.OSC.TBlob(s.toBinary())}this.message+=i,this.typetags+="b"},t.OSC.Bundle.prototype.toBinary=function(){var e=new t.OSC.TString("#bundle");return e=e.concat(new t.OSC.TTimeTag(this.timetag)),e=e.concat(this.message)},t.OSC.Encoder=function(){},t.OSC.Encoder.prototype={encode:function(){var e;if(arguments[0].toBinary)e=arguments[0].toBinary();else{var i={};t.OSC.Message.apply(i,arguments),e=t.OSC.Message.prototype.toBinary.call(i)}return e}},t.OSC.ShortBuffer=function(t,e,i){this.type="ShortBuffer";for(var s="buffer [",r=0;e.length>r;r++)r&&(s+=", "),s+=e.charCodeAt(r);s+="] too short for "+t+", "+i+" bytes required",this.message=s},t.OSC.TString=function(t){this.value=t},t.OSC.TString.prototype={typetag:"s",decode:function(t){for(var e=0;t[e]&&t.length>e;)e++;if(e==t.length)throw Error("OSC string not null terminated");this.value=String.fromCharCode.apply(null,t.slice(0,e));var i=parseInt(4*Math.ceil((e+1)/4),10);return t.slice(i)},encode:function(){var t=4*Math.ceil((this.value.length+1)/4,10),e=Array(t);return Struct.PackTo(">"+t+"s",e,0,[this.value])}},t.OSC.TInt=function(t){this.value=t},t.OSC.TInt.prototype={typetag:"i",decode:function(t){if(4>t.length)throw new ShortBuffer("int",t,4);return this.value=Struct.Unpack(">i",t.slice(0,4))[0],t.slice(4)},encode:function(){var t=Array(4);return Struct.PackTo(">i",t,0,[this.value])}},t.OSC.TTime=function(t){this.value=t},t.OSC.TTime.prototype={typetag:"t",decode:function(t){if(8>t.length)throw new ShortBuffer("time",t,8);return this.value=Struct.Unpack(">LL",t.slice(0,8))[0],t.slice(8)},encode:function(t,e){return Struct.PackTo(">LL",t,e,this.value)}},t.OSC.TFloat=function(t){this.value=t},t.OSC.TFloat.prototype={typetag:"f",decode:function(t){if(4>t.length)throw new ShortBuffer("float",t,4);return this.value=Struct.Unpack(">f",t.slice(0,4))[0],t.slice(4)},encode:function(){var t=Array(4);return Struct.PackTo(">f",t,0,[this.value])}},t.OSC.TBlob=function(t){this.value=t},t.OSC.TBlob.prototype={typetag:"b",decode:function(t){var e=Struct.Unpack(">i",t.slice(0,4))[0],i=parseInt(4*Math.ceil(e/4),10)+4;return this.value=t.slice(4,e+4),t.slice(i)},encode:function(t,e){var i=4*Math.ceil(this.value.length/4,10);return Struct.PackTo(">i"+i+"s",t,e,[i,this.value])}},t.OSC.TDouble=function(t){this.value=t},t.OSC.TDouble.prototype={typetag:"d",decode:function(t){if(8>t.length)throw new ShortBuffer("double",t,8);return this.value=Struct.Unpack(">d",t.slice(0,8))[0],t.slice(8)},encode:function(t,e){return Struct.PackTo(">d",t,e,[this.value])}},t.OSC.tagToConstructor={i:function(){return new t.OSC.TInt},f:function(){return new t.OSC.TFloat},s:function(){return new t.OSC.TString},b:function(){return new t.OSC.TBlob},d:function(){return new t.OSC.TDouble}},t.OSC.decodeBundle=function(e){var i=[],s={time:null,args:[]},r=new t.OSC.TTime;for(e=r.decode(e),s.time=r.value;e.length>0;){var n=new t.OSC.TInt;e=n.decode(e);var o=t.OSC.decode(e.slice(0,n.value));s.args.push(o),e=e.slice(n.value)}return i.push(s),i},t.OSC.decode=function(e){var i=[],s=new t.OSC.TString;if(e=s.decode(e),i.push(s.value),"#bundle"===s.value)return t.OSC.decodeBundle(e);if(e.length>0){var r=new t.OSC.TString;if(e=r.decode(e),r=r.value,","!=r[0])throw"invalid type tag in incoming OSC message, must start with comma";for(var n=1;r.length>n;n++){var o=t.OSC.tagToConstructor[r[n]];if(!o)throw"Unsupported OSC type tag "+r[n]+" in incoming message";var h=o();e=h.decode(e),i.push(h.value)}}return i},t.OSC.Decoder=function(){},t.OSC.Decoder.prototype.decode=function(e){var i=t.OSC.decode(e);try{if(i)return i}catch(s){}},t.OSCClient=function(t,e){this.oscHandler=e,this.clientID=t.clientID,this.oscCallback=t.oscCallback,this.isListening=t.isListening||!0},t.OSCClient.prototype.sendOSC=function(t,e){var i=this.oscHandler.OSCEncoder.encode(t),s=e;e===void 0&&(s={sendRemote:!0,sendLocal:!0}),s.sendRemote!==!1&&this.oscHandler.proxyOK===!0&&this.oscHandler.socket.emit("osc",{osc:i}),s.sendLocal!==!1&&this.oscHandler.sendLocalMessage.apply(this.oscHandler,[i,this.clientID])},t.OSCHandler=function(e,i){if(this.localClients={},this.OSCDecoder=new t.OSC.Decoder,this.OSCEncoder=new t.OSC.Encoder,this.udpServers=i||null,this.proxyServer=e||null,this.proxyOK=!1,this.proxyConnected=!1,null!==this.proxyServer){try{this.socket=io.connect("http://"+this.proxyServer.host+":"+this.proxyServer.port)}catch(s){return}this.socket.on("admin",function(){this.proxyOK=!0,null!==this.udpServers&&this.socket.emit("admin",{type:"udphosts",content:this.udpServers})}.bind(this)),this.socket.on("osc",function(t){var e=Array.prototype.slice.call(t.osc,0);this.sendLocalMessage(e)}.bind(this)),this.socket.on("disconnect",function(){this.proxyConnected=!1,this.proxyOK=!1}.bind(this)),this.socket.on("connect",function(){this.proxyConnected=!0}.bind(this))}},t.OSCHandler.prototype.registerClient=function(e){return this.localClients[e.clientID]=new t.OSCClient(e,this),this.localClients[e.clientID]},t.OSCHandler.prototype.unregisterClient=function(t){delete this.localClients[t]},t.OSCHandler.prototype.sendLocalMessage=function(t,e){var i=this.OSCDecoder.decode(t);for(var s in this.localClients)if(this.localClients.hasOwnProperty(s)){var r=this.localClients[s];r.clientID!==e&&r.isListening&&"function"==typeof r.oscCallback&&r.oscCallback(i)}},t.loadImageArray=function(t){this.onCompletion=function(){if("function"==typeof this.onComplete){var t=this.pollStatus(),e={imagesArray:this.imagesArray,status:t};this.onComplete(e)}},this.onLoad=function(t){return function(){t.objectsLoaded+=1,t.check(t.onSingle,this)}},this.onError=function(t){return function(){t.objectsError+=1,t.check(t.onErr,this)}},this.check=function(t,e){if("function"==typeof t){var i=this.pollStatus();t({obj:e,status:i})}this.objectsLoaded+this.objectsError===this.objectsTotal&&this.onCompletion()},this.pollStatus=function(){return{id:this.ID,loaded:this.objectsLoaded,error:this.objectsError,total:this.objectsTotal}},this.ID=t.ID,this.onComplete=t.onComplete,this.onSingle=t.onSingle,this.onErr=t.onError,this.objectsLoaded=0,this.objectsError=0,this.objectsTotal=t.imageNames.length,this.imagesArray=[];for(var e=0;this.objectsTotal>e;e+=1)this.imagesArray[e]=new Image,this.imagesArray[e].onload=this.onLoad(this),this.imagesArray[e].onerror=this.onError(this),this.imagesArray[e].src=t.imageNames[e]},t.loadMultipleImages=function(t){this.loadingManager=function(){var t=this;return function(e){var i=e;if(void 0===t.loaders[i.status.id])throw Error("in loaders, "+i.status.id+" is undefined");t.loaders[i.status.id].done=!0,t.loaders[i.status.id].images=t.loaders[i.status.id].imageArray.imagesArray,"function"==typeof t.onSingleArray&&t.onSingleArray(e);for(var s in t.loaders)if(t.loaders.hasOwnProperty(s)&&t.loaders[s].done!==!0)return;t.onComplete(t.loaders)}},this.errorManager=function(){var t=this;return function(e){"function"==typeof t.onError&&t.onError(e)}},this.singleManager=function(){var t=this;return function(e){"function"==typeof t.onSingle&&t.onSingle(e)}},this.multipleImages=t.multipleImages,this.onComplete=t.onComplete,this.onError=t.onError,this.onSingle=t.onSingle,this.onSingleArray=t.onSingleArray,this.loaders={};for(var e=0;this.multipleImages.length>e;e+=1){var i={};i.imageArray=new loadImageArray({ID:this.multipleImages[e].ID,imageNames:this.multipleImages[e].imageNames,onComplete:this.loadingManager(),onError:this.errorManager(),onSingle:this.singleManager()}),i.done=!1,this.loaders[this.multipleImages[e].ID]=i}},t.GenericUtils={},t.GenericUtils.clone=function(e){var i;if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return i=new Date,i.setTime(e.getTime()),i;if(e instanceof Array){i=[];for(var s=0,r=e.length;r>s;++s)i[s]=t.GenericUtils.clone(e[s]);return i}if(e instanceof Object){i={};for(var n in e)e.hasOwnProperty(n)&&(i[n]=t.GenericUtils.clone(e[n]));return i}throw Error("Unable to copy obj! Its type isn't supported.")},t.MathUtils={},t.MathUtils.linearRange=function(t,e,i,s,r){var n=(r-t)*(s-i)/(e-t)+i;return n},t.MathUtils.distance=function(t,e,i,s){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-s,2))},t.MathUtils.fact_table=[1,1,2,6,24,120,720,5040,40320,362880,3628800,39916800,479001600,6227020800,87178291200,1307674368e3,20922789888e3,355687428096e3,6402373705728e3,0x1b02b9306890000,243290200817664e4,5109094217170944e4,0x3ceea4c2b3e0d80000,2.585201673888498e22,6.204484017332394e23,1.5511210043330986e25,4.0329146112660565e26,1.0888869450418352e28,3.0488834461171387e29,8.841761993739702e30,2.6525285981219107e32,8.222838654177922e33,2.631308369336935e35,8.683317618811886e36,2.9523279903960416e38,1.0333147966386145e40,3.7199332678990125e41,1.3763753091226346e43,5.230226174666011e44,2.0397882081197444e46,8.159152832478977e47,3.345252661316381e49,1.40500611775288e51,6.041526306337383e52,2.658271574788449e54,1.1962222086548019e56,5.502622159812089e57,2.5862324151116818e59,1.2413915592536073e61,6.082818640342675e62,3.0414093201713376e64,1.5511187532873822e66,8.065817517094388e67,4.2748832840600255e69,2.308436973392414e71,1.2696403353658276e73,7.109985878048635e74,4.0526919504877214e76,2.3505613312828785e78,1.3868311854568984e80,8.32098711274139e81,5.075802138772248e83,3.146997326038794e85,1.98260831540444e87,1.2688693218588417e89,8.247650592082472e90,5.443449390774431e92,3.647111091818868e94,2.4800355424368305e96,1.711224524281413e98,1.1978571669969892e100,8.504785885678623e101,6.1234458376886085e103,4.4701154615126844e105,3.307885441519386e107,2.48091408113954e109,1.8854947016660504e111,1.4518309202828587e113,1.1324281178206297e115,8.946182130782976e116,7.156945704626381e118,5.797126020747368e120,4.753643337012842e122,3.945523969720659e124,3.314240134565353e126,2.81710411438055e128,2.4227095383672734e130,2.107757298379528e132,1.8548264225739844e134,1.650795516090846e136,1.4857159644817615e138,1.352001527678403e140,1.2438414054641308e142,1.1567725070816416e144,1.087366156656743e146,1.032997848823906e148,9.916779348709496e149,9.619275968248212e151,9.426890448883248e153,9.332621544394415e155,9.332621544394415e157],t.MathUtils.fact_lookup=function(e){if(100>=(e>0))return t.MathUtils.fact_table[e];for(var i=1,s=2;e>=s;s++)i*=s;return i},t.CanvasUtils={},t.CanvasUtils.drawRotate=function(t,e){t.save(),t.translate(e.x+e.image.width/2,e.y+e.image.height/2),t.rotate(e.rot),t.translate(-(e.image.width/2)-e.x,-(e.image.height/2)-e.y),t.drawImage(e.image,e.x,e.y),t.restore()},"function"==typeof define&&define.amd)define(["hammerjs"],function(e){return t.Hammer=e,t});else{if(window.Hammer===void 0)throw"Hammer.js needed!";t.Hammer=window.Hammer,window.kievII=window.K2=t}})();